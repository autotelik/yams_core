<div class="media row">

  <div class="accordion-item album-track col-4">
    <div class="card card-sm col p-0">
      <%= bootstrap_card_header( t(:albums, scope: :global)) %>
    </div>

    <% if @albums.present? %>
      <%= datashift_audio_player_in_navbar(init_url: yams_core.audio_player_init_url,
                                           load_url: yams_core.album_url(@albums.first, format: :json)) %>
    <% end %>

    <ul id="album-index" class="striped-list list-group list-group-flush">
      <% @albums.each do |album| %>

        <li id="album_row_<%= album.id %>">
          <% album = YamsCore::AlbumPresenter.new(album, self) %>
          <div class="media align-items-center">
            <div class="accordion-item album-track col-12">
              <div class="card card-sm ml-2 mr-2">
                <div class="card-header col-12">
                  <div class="row">
                    <div class="col-2">
                      <!-- format: json does not work ?? -->
                      <%= album.cover_image_tag %>
                    </div>
                    <div class="col">
                      <%= link_to(album.title, yams_core.album_url(album, format: :json), id: "select_album_row_#{album.id}") %>

                      <script type="text/javascript" charset="utf-8">
                          $('#<%= "select_album_row_#{album.id}" %>').click(function (event) {
                              event.preventDefault(); // Prevent link from following its href
                              datashift_audio_engine.load('<%= yams_core.album_url(album, format: :json) %>');
                          });
                      </script>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>
      <% end %>
    </ul>
  </div>

  <!-- datashift audio JS insertion point, for rendering any list of tracks -->
  <div id="datashift-audio-playlist" class="col-8"></div>

</div>

<script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
        datashift_audio_engine.settings.autoplay = true;
        datashift_audio_engine.save_interval = 30000;

        // auto load first album in list
        <% if @albums.present? %>
          datashift_audio_engine.load('<%= yams_core.album_url(@albums.first, format: :json) %>');
        <% end %>
    });
</script>
